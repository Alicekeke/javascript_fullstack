# HTTPS 协议简介

涉及到支付等严肃场景，HTTP是不够的，需要HTTPS   

HTTPS = HTTP + SSL(安全套接字) / TLS(传输层安全)      

HTTPS相对于HTTP在TCP与HTTP层之间添加了安全层（SSL/TSL），其中SSL和TSL都是一种加密通道的规范     

## 加密
加密分为两种：对称加密和非对称加密      

- 对称加密
  在对称加密算法中，加密和解密使用的 密钥 是相同的。也就是说，加密和解密使用的是同一个密钥。因此，对称加密算法要保证安全性的话，密钥要做好保密。只能让使用的人知道，不能对外公开。

- 非对称加密
  在非对称加密算法中，加密使用的密钥和解密使用的密钥是不相同的。一把是作为公开的**公钥**，另一把是作为谁都不能给的**私钥**。公钥加密的信息，只有私钥才能解密。私钥加密的信息，只有公钥才能解密。

  结论：**非对称加密主要用于传输辅助对称加密的秘钥，而真正的双方大数据量的通信都是通过对称加密进行**    

  性能：对称加密 > 非对称加密   


  对称加密时：加密解密的秘钥是一样的，黑客截获请求也无法破译，但怎么安全的传递秘钥呢？        
  非对称加密：首先要明白公钥是谁都可以获得的，包括黑客，为了解决这个问题，看来一对公钥私钥是不够的，客户端也需要有自己的公钥和私钥，并且客户端要把自己的公钥，给另一端。        

- 数字证书，第三方CA担保
  非对称加密问题：

  - 如何将不对称加密的公钥给对方呢？
  - 怎么鉴别别人给你的公钥是对的。会不会有人冒充，发给你一个它的公钥。
  
  这时就需要权威部门的介入了，这个由权威部门颁发的称为证书（Certificate）   

  证书里面有什么：当然应该有公钥，这是最重要的；还有证书的所有者，证书的发布机构和证书的有效期。

  这个证书是怎么生成的呢？会不会有人假冒权威机构颁发证书呢？就像有假身份证、假户口本一样。生成证书需要发起一个证书请求，然后将这个请求发给一个权威机构去认证，这个权威机构我们称为 CA（ Certificate Authority）     

  权威机构会证书卡一个章，我们称为签名算法：    

  问题又来了，那怎么签名才能保证是真的权威机构签名的呢？当然只有用只掌握在权威机构手里的东西签名了才行，这就是 CA 的私钥。

  签名算法大概是这样工作的：一般是对信息做一个 Hash 计算，得到一个 Hash 值，这个过程是不可逆的，也就是说无法通过 Hash 值得出原来的信息内容。在把信息发送出去时，把这个 Hash 值加密（CA有用自己的私钥）后，作为一个签名和信息一起发出去。

  ？**私钥加密过后的信息**  签名和信息 随着证书一起颁发出来，怎么校验？？？   

  - CA 机构公钥：操作系统里面，操作系统 “所有” CA的公钥都内置了。
  - 签名： Hash 值
  - 公钥的信息 ：hash（公钥的信息）= hash 值

  CA 用自己的私钥给银行网站的公钥签名，就相当于担保人。   

  数字签名的对比过程    

  用户A将待发送的信息原文经散列函数运算生成**摘要**，并用自己的**私钥**对摘要信息进行加密，将形成的密文和原文传送给用户B。用户B接收到密文后，使用A的公开密钥验证密文，得到摘要，并按照约定的摘要算法对原文进行摘要运算，再**将两个摘要值进行比对**，一致则表明数据未被篡改。    

  ## HTTP的工作模式

  我们可以知道，非对称加密在性能上不如对称加密，那是否能将两者结合起来呢？例如，公钥私钥主要用于传输对称加密的秘钥，而真正的双方大数据量的通信都是通过对称加密进行的。
    ![http工作模式](https://image-static.segmentfault.com/249/646/249646327-ab9d5f61b47a92c5)
  - 由于是 HTTPS，客户端会发送 Client Hello 消息到服务器，以明文传输 TLS 版本信息、加密套件候选列表、压缩算法候选列表等信息。另外，还会有一个随机数，在协商对称密钥的时候使用。
  - Server Hello 消息, 告诉客户端，服务器选择使用的协议版本、加密套件、压缩算法等，还有一个随机数，用于后续的密钥协商。
银行网站会给你一个服务器端的证书
  - 从自己信任的 CA 仓库中，拿 CA 的证书里面的公钥去解密银行网站的证书。如果能够成功，则说明银行网站是可信的。这个过程中，你可能会不断往上追溯 CA、CA 的 CA、CA 的 CA 的 CA，反正直到一个授信的 CA，就可以了。
  - 证书验证完毕之后，觉得这个银行网站可信，于是客户端计算产生随机数字 Pre-master，用证书中的公钥加密，再发送给服务器，服务器可以通过私钥解密出来。
  - 到目前为止，无论是客户端还是服务器，都有了三个随机数，分别是：自己的、对端的，以及刚生成的 Pre-Master 随机数。通过这三个随机数，可以在客户端和服务器产生相同的对称密钥。
  - 有了对称密钥
  - 当双方握手结束之后，就可以通过对称密钥进行加密传输了。