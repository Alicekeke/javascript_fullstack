### 为什么要硬件加速？

卡顿、掉帧是在移动web开发时经常遇到的问题，一般我们会用到css3硬件加速。   
其实就是利用 GPU 进行渲染，减少 CPU 操作      
由于 GPU 中的 transform 等 CSS 属性不会触发 repaint，所以能大大提高网页的性能。       
 
### 原理

浏览器渲染的图层一般包含两大类：普通图层和合成层，其中，普通图层可以理解为一个复合图层，（无论多少元素嵌套，都是在同一个复合层里，就算absolute或fixed脱离了文档流，它也是属于默认复合层）只有开启了硬件加速，才能新开一个合成层。

DOM树和CSS结合后形成渲染树。渲染树中包含了大量的渲染元素，每一个渲染元素会被分到一个图层中，每个图层又会被加载到GPU形成渲染纹理。GPU中transform是不会触发 repaint 的，这一点非常类似3D绘图功能，最终这些使用 transform的图层都会由独立的合成器进程进行处理。

### 开启GPU加速
可以通过这几个css属性
- transform
- opacity
- filter
- will-change

如果有一些元素不需要用到上述属性，但是需要触发硬件加速效果，可以使用一些小技巧来诱导浏览器开启硬件加速
```css

.element {
    -webkit-transform: translateZ(0);
    -moz-transform: translateZ(0);
    -ms-transform: translateZ(0);
    -o-transform: translateZ(0);
    transform: translateZ(0); 
    /**或者**/
    transform: rotateZ(360deg);
    transform: translate3d(0, 0, 0);
}
```

### 要注意的问题
- 过多地开启硬件加速可能会耗费较多的内存，因此什么时候开启硬件加速，给多少元素开启硬件加速，需要用测试结果说话。
- 把元素塞进复合层时需要额外重绘，有时很慢（可能需要整页重绘）
- 复合层数据传递给GPU有额外时耗，取决于复合层的数量和大小，这在中低端设备可能会导致闪烁
- 文字模糊，元素有时会变形
- 最主要的问题集中在内存消耗和repaint上，所以动画性能优化目标是降低内存消耗，减少repaint

### 优化使用场景
- .尽量避免隐式复合层
- 减少复合层的大小，减少传递给GPU的数据
- 通过硬件加速的方式，声明一个新的合成层，它会单独分配资源（当然也会脱离普通文档流）这样一来，无论合成层中怎么变化，也不会影响默认复合层里的回流和重绘
  如果不想被其他元素牵连导致回流和重绘的元素，可以通过提升到合成层的方式去处理这个元素。


### 参考
[css硬件加速](https://lz5z.com/Web%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-CSS3%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/)
[auto.io](https://aotu.io/notes/2017/04/11/GPU/index.html)