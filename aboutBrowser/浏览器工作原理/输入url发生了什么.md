# 浏览器中输入一个url，按回车之后发生了什么？


## 1. 浏览器查找域名的ip地址

- 浏览器解析出url中的域名。
- 查询浏览器的DNS缓存。
- 浏览器中没有DNS缓存，则查找本地客户端hosts文件有无对应的ip地址。
- hosts中无，则查找本地DNS服务器（运营商提供的DNS服务器）有无对应的DNS缓存。
- 若本地DNS没有DNS缓存，则向根服务器查询，进行递归查找。
- 递归查找从顶级域名开始（如.com）,一步步缩小范围，最终客户端取得ip地址。

## 浏览器与目标服务器建立TCP连接

- http协议建立在tcp协议之上，http请求前，需先进行tcp连接，形成客户端到服务器的稳定的通道。俗称TCP的三次握手。
- tcp连接完成后，http请求开始，请求有多种方式，常见的有get，post等。http请求包含请求头，也可能包含请求体两部分，请求头中包含我们希望对请求文件的操作的信息，请求体中包含传递给后台的参数。
- 服务器收到http请求后，后台开始工作，如负载平衡，跨域等，这里就是后端的工作了。
- 文件处理完毕，生成响应数据包，响应也包含两部分，响应头和相应体，响应体就是我们所请求的文件。
- 经过网络传输，文件被下载到本地客户端，客户端开始加载。

## html页面的解析与渲染

- 客户端浏览器加载了html文件后，由上到下解析html为DOM树（DOM Tree）。
- 遇到css文件，css中的url发起http请求。
- 这是第二次http请求，由于http1.1协议增加了Connection: keep-alive声明，故tcp连接不会关闭，可以复用。
- http连接是无状态连接，客户端与服务器端需要重新发起请求--响应。在请求css的过程中，解析器继续解析html，然后到了script标签。
- 由于script可能会改变DOM结构，故解析器停止生成DOM树，
- 解析器被js阻塞，等待js文件发起http请求，然后加载。这是第三次http请求。js执行完成后解析器继续解析。
- 由于css文件可能会影响js文件的执行结果，因此需等css文件加载完成后再执行。
- 浏览器收到css文件后，开始解析css文件为CSSOM树（CSS Rule Tree）。
- CSSOM树生成后，DOM Tree与CSS Rule Tree结合生成渲染树（Render Tree）。
- Render Tree会被css文件阻塞，渲染树生成后，先布局，绘制渲染树中节点的属性(位置，宽度，大小等)，然后渲染，页面就会呈现信息。
- 继续边解析边渲染，遇到了另一个js文件，js文件执行后改变了DOM树，渲染树从被改变的dom开始再次渲染。
- 继续向下渲染，碰到一个img标签，浏览器发起http请求，不会等待img加载完成，继续向下渲染，之后再重新渲染此部分。
- DOM树遇到html结束标签，停止解析，进而渲染结束。


# GET 和 POST 的区别

- GET在浏览器**回退**时是无害的，而POST会再次提交请求。
- GET产生的URL地址可以被存放为**书签**，而POST不可以。
- GET请求会被**浏览器主动cache**，而POST不会，除非手动设置。
- GET请求只能进行url**编码**，而POST支持多种编码方式。
- GET请求参数会被完整保留在浏览器**历史记录**里，而POST中的参数不会被保留。
- GET请求在URL中传送的参数是有**长度限制**的，而POST么有。
- 对参数的**数据类型**，GET只接受ASCII字符，而POST没有限制。
- GET比POST更不**安全**，因为参数直接暴露在URL上，所以不能用来传递敏感信息。
- GET参数通过URL**传递**，POST放在Request body中。
